function blogScrollHandler(){return $("#posts div").is("#noBlogPost")?!1:void $(window).off("scroll").on("scroll",function(){if(isLoading)return!1;if(!$("#content div").is("#posts"))return $(window).off("scroll"),!1;var e=$(window).scrollTop();e>=.7*($(document).height()-$(window).height())&&ajaxRequest("#posts",0,0,0,0,0,1)})}function ajaxLinkHandler(e,a,n,t,o,c,i){$(e).on("click",a,function(){return ajaxRequest(a,n,t,o,c,this,i),!1})}function ajaxRequest(e,a,n,t,o,c,i){if(!ajaxArrange(e,n,o,c))return!1;var s=c?c:document.location;$.ajax({dataType:"json",timeout:3e3,url:"ajax",data:{link:s.hash?s.hash.substring(1):[s.pathname,s.search].join(""),command:i,offset:1===i?$("#blogUpdateSettings").attr("data-offset"):4===i?$("#ReviewsUpdateSettings").attr("data-offset"):0},beforeSend:function(){preLoader(i,c)},success:function(n){ajaxSuccess(n,e,c),ajaxEnd(n,t,a,c)},error:function(){ajaxError(i)},complete:function(){preLoader(i,c),isLoading=0}})}function preLoader(e,a){switch(e){case 0:case 3:$("#content").toggleClass("loading");break;case 1:$("#blogUpdatePreLoader").toggleClass("loading");break;case 2:$(a).parents(".post").toggleClass("loading");break;case 4:$("#ReviewsPreLoader").toggleClass("loading")}}function ajaxError(e){switch(e){case 0:case 3:document.location.reload();break;case 1:break;case 2:break;case 3:}}function ajaxArrange(e,a,n,t){return n&&(yaCounter28763381.hit(t.href,t.title,""===document.location.hash?document.location.pathname+document.location.search:document.location.hash.substring(1)),ga("send",{hitType:"pageview",page:t.href,title:t.title})),a&&history.pushState(null,null,t.href),"/contacts"===t.pathname||"contacts"===t.pathname?(isLoading=1,$("html, body").animate({scrollTop:$("#redFlag").offset().top},"fast",function(){isLoading=0}),!1):(isLoading=1,!0)}function ajaxEnd(e,a,n,t){a&&(document.title=e.pageTitle),n&&$(t.parentNode).addClass("active-a").siblings(".active-a").removeClass("active-a"),("/blog"===document.location.pathname||"#/blog"===document.location.hash)&&blogScrollHandler()}function ajaxSuccess(e,a,n){("#nav a.mainMenuItem"===a||2===a.length)&&ajaxContent(e,n),("#servicesHome a"===a||"services"===a[1]&&3===a.length)&&ajaxServicesMenuImg(e),"#servicesNav li a"===a&&ajaxServicesMenu(e),".post .serviceLinks"===a&&ajaxBlogPost(e,n),".tags a"===a&&ajaxBlogTag(e,n),"#posts"===a&&ajaxBlogUpdatePosts(e),"a#MoreReviews"===a&&ajaxReviewsUpdate(e)}function ajaxContent(e,a){var n=e.tagList;$("#content").empty().append(n,e.content),e.tagList&&$(['.tags a[href="',document.location.hash?document.location.hash.substring(2):document.location.pathname.substring(1)+document.location.search.split("&")[0],'"]'].join("")).parent().addClass("active-a")}function ajaxServicesMenuImg(e){$("#content").empty().append(e.servicesMenu,$("<div>").append(["<h1>",e.pageTitle.split("—")[0],"</h1><hr>",e.content].join("")).prop("id","servicesInfo")),$('#mainMenu a[href="services"]').parent().addClass("active-a").siblings(".active-a").removeClass("active-a"),$(['#servicesNav a[href="',document.location.hash?document.location.hash.substring(2):document.location.pathname.substring(1),'"]'].join("")).parent().addClass("active-a")}function ajaxServicesMenu(e){$("#servicesInfo").empty().append(["<h1>",e.pageTitle.split("—")[0],"</h1><hr>",e.content].join(""))}function ajaxBlogPost(e,a){var n=$(a).parents(".post"),t=n.children(".contentPost"),o=n.find(".expand a");t.append(e.content).slideToggle("fast"),o.html("Свернуть пост"),o.removeClass("downArrow").addClass("upArrow"),$(['.post a[href="',a.hash?a.hash.substring(2):a.pathname.substring(1),'"]'].join("")).on("click",function(){return t.slideToggle("fast"),o.hasClass("off")?(o.html("Свернуть пост"),o.removeClass("downArrow").addClass("upArrow")):(o.html("Развернуть пост"),o.removeClass("upArrow").addClass("downArrow")),o.toggleClass("off"),!1})}function ajaxBlogTag(e,a){$("#content").empty().append(e.tagList,e.content),$([".tags li:contains(",$(a).text(),")"].join("")).addClass("active-a").siblings(".active-a").removeClass("active-a")}function ajaxBlogUpdatePosts(e){$("#posts").append(e.content),$("#blogUpdateSettings").attr("data-offset",parseInt($("#blogUpdateSettings").attr("data-offset"))+3),e.content||($(window).off("scroll"),$("#posts").append($('<div id="noBlogPost" class="icon tick">').append("На сегодня все. Ждите обновлений.")))}function ajaxReviewsUpdate(e){$("#comments").append(e.content),$("#ReviewsUpdateSettings").attr("data-offset",parseInt($("#ReviewsUpdateSettings").attr("data-offset"))+10),e.content||($("#MoreReviews").hide(),$("#MoreReviews").after($('<div class="no-reviews" class="icon tick">').append("Пока все. Оставьте свой отзыв.")))}function calcServices(e){switch(e){case"Sound":createInnerDiv(document.getElementById("calcServices"),soundBlocks.typeSound),typeCalc=soundOutput}var a=document.createElement("div");a.id="totalPrice",a.innerHTML=calcTotalPrice,document.getElementById("content").appendChild(a)}function pricing(e,a){for(var n=e.parentNode.getElementsByTagName("span"),t=0;t<n.length;t++)if("priceService"===n[t].className){var o=n[t].parentNode;o!==e&&"activeElement"===o.className.slice(12,25)&&(calcTotalPrice-=Number(n[t].innerHTML)),o===a&&"LABEL"!==o.tagName&&(calcTotalPrice-=Number(n[t].innerHTML)),o===e&&("LABEL"===o.tagName?o.firstChild.checked===!0?calcTotalPrice+=Number(n[t].innerHTML):calcTotalPrice-=Number(n[t].innerHTML):calcTotalPrice+=Number(n[t].innerHTML))}document.getElementById("totalPrice").innerHTML=calcTotalPrice}function clickCalcElement(e){for(var a=e.parentNode.childNodes,n=0;n<a.length;n++)if("activeElement"===a[n].className.slice(12,25)){var t=a[n];break}if(addRemoveActiveClass(e,t)===!1)return!1;var o,n,c=e.childNodes;for(n=0;n<c.length;n++)"nameService"===c[n].className&&(o=c[n].innerHTML);if(pricing(e,t),"LABEL"===e.tagName&&void 0===typeCalc[o])return!1;if(void 0===typeCalc[o]||e.firstChild.checked===!1)return removeInnerBlock(e.parentNode),!1;for(createInnerDiv(e,typeCalc[o][0]),typeCalc[o].length>1&&(count=typeCalc[o].length),n=1;count>n;n++)createInnerDiv(e,typeCalc[o][n]),count--}function addRemoveActiveClass(e,a){a=a||!1;var n=e.className.slice(12,25);return"LABEL"===e.tagName?("activeElement"===n?(e.className="calcElement",e.firstChild.checked=!1):(e.className+=" activeElement",e.firstChild.checked=!0),e):"activeElement"===n?!1:(a&&(a.className="calcElement"),e.className+=" activeElement",e)}function removeInnerBlock(e){"inner"===e.lastChild.className&&1===count&&e.removeChild(e.lastChild)}function createInnerDiv(e,a){var n=e.parentNode;if(removeInnerBlock(e.parentNode),"inner"!==n.lastChild.className){var t=document.createElement("div");t.className="inner",n.appendChild(t)}createElementsInnerDiv(n,a),createBr(n.lastChild)}function createElementsInnerDiv(e,a){var n=document.createElement("div");e.lastChild.appendChild(n);for(var t=function(){return clickCalcElement(this),!1},o=3;o<a.length;o++){var c=document.createElement("span");if(c.className="nameService",c.innerHTML+=a[o],a[0]){var i=document.createElement("input"),s=document.createElement("label");s.className="calcElement",i.type="checkbox",s.onclick=t,s.appendChild(i),s.appendChild(c),e.lastChild.lastChild.appendChild(s)}else{var l=document.createElement("div");l.className="calcElement",l.onclick=t,l.appendChild(c),e.lastChild.lastChild.appendChild(l)}if(a[2]){var r=document.createElement("span");r.className="priceService",r.innerHTML=a[o+1],l?l.appendChild(r):s.appendChild(r),o++}}}function createBr(e){var a=document.createElement("br");e.appendChild(a)}var isLoading=0;$(window).ready(function(){ajaxLinkHandler("#mainMenu","#nav a.mainMenuItem",1,1,1,1,0),ajaxLinkHandler("#content","#servicesHome a",0,1,1,1,0),ajaxLinkHandler("#content","#servicesNav li a",1,1,1,1,3),ajaxLinkHandler("#content",".post .serviceLinks",0,0,0,1,2),ajaxLinkHandler("#content",".tags a",1,1,0,1,0),ajaxLinkHandler("#content","a#MoreReviews",0,0,0,0,4),blogScrollHandler(),$(window).on("popstate",function(e){var a=(history.location.pathname||document.location.pathname).split("/");$(['#mainMenu a[href="',a[1]?a[1]:document.location.href,'"]'].join("")).parent().addClass("active-a").siblings(".active-a").removeClass("active-a"),ajaxRequest(a,0,0,1,0,0,0)}),$(['.tags a[href="',document.location.pathname.substring(1)+document.location.search,'"]'].join("")).parent().addClass("active-a").siblings(".active-a").removeClass("active-a")});var count=1,typeCalc,calcTotalPrice=0,soundBlocks={typeSound:[!1,!1,!1,"Автомагнитолы","Динамики","Усилители, сабвуферы"],jackSound:[!1,!1,!1,"1 Din","2 Din","Штатные ГУ"],iso:[!0,!1,!0,"ISO разъем отсутствует",300],regionCar:[!1,!1,!0,"Иномарка",500,"Отечественная",600],antennaBosch:[!0,!1,!0,"Установка антенны типа Bosch",800],cutPlastic:[!0,!1,!0,"Надо или нет резать пластик",700]},soundOutput={"Автомагнитолы":[soundBlocks.jackSound],"1 Din":[soundBlocks.iso,soundBlocks.regionCar],"2 Din":[soundBlocks.cutPlastic],"Иномарка":[soundBlocks.antennaBosch],"ISO разъем отсутствует":[soundBlocks.regionCar]};calcServices("Sound");